<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Linear Models: Building and Interpreting Linear Regressions • compbio2020</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Linear Models: Building and Interpreting Linear Regressions">
<meta property="og:description" content="compbio2020">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compbio2020</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_Syllabus_and_Expectations.html">Syllabus</a>
    </li>
    <li>
      <a href="../articles/01_Getting_Started_with_R.html">Starting with R</a>
    </li>
    <li>
      <a href="../articles/02_Starting_with_Data.html">Starting with data</a>
    </li>
    <li>
      <a href="../articles/03_Manipulating_Data.html">Manipulating, analyzing and exporting data with tidyverse</a>
    </li>
    <li>
      <a href="../articles/04-plotting.html">Data visualization with ggplot2</a>
    </li>
    <li>
      <a href="../articles/05_Functions.html">Functions and repeatability</a>
    </li>
    <li>
      <a href="../articles/06_Exploration_Setup.html">Exploration</a>
    </li>
    <li>
      <a href="../articles/06_Project_Structuring.html">Project Structuring</a>
    </li>
    <li>
      <a href="../articles/08_linear_models.html">Introduction to Linear Models: Building and Interpreting Linear Regressions</a>
    </li>
    <li>
      <a href="../articles/09_Tree_of_life.html">GeneticData</a>
    </li>
    <li>
      <a href="../articles/10_GBIF_and_Location.html">GBIF And Spatial Data</a>
    </li>
    <li>
      <a href="../articles/11_iNEXT.html">Camera Trap Data Analysis</a>
    </li>
    <li>
      <a href="../articles/HomeworkFive.html">Homework Five</a>
    </li>
    <li>
      <a href="../articles/HomeworkSix.html">HomeworkSix</a>
    </li>
    <li>
      <a href="../articles/Simulation.html">Simulations</a>
    </li>
    <li>
      <a href="../articles/bonus_tables.html">Tables.Rmd</a>
    </li>
    <li>
      <a href="../articles/homework_0.html">How to Do Homework</a>
    </li>
    <li>
      <a href="../articles/homework_1.html">Homework One</a>
    </li>
    <li>
      <a href="../articles/homework_2.html">Homework Two</a>
    </li>
    <li>
      <a href="../articles/homework_3.html">Homework Three</a>
    </li>
    <li>
      <a href="../articles/homework_4.html">Homework Four</a>
    </li>
    <li>
      <a href="../articles/homework_5.html">Homework Five: Functions</a>
    </li>
    <li>
      <a href="../articles/homework_6.html">HomeworkSix.Rmd</a>
    </li>
    <li>
      <a href="../articles/homework_7.html">Homework Seven</a>
    </li>
    <li>
      <a href="../articles/project_final.html">Project: Final</a>
    </li>
    <li>
      <a href="../articles/project_one.html">ProjectOne</a>
    </li>
    <li>
      <a href="../articles/project_three.html">ProjectThree</a>
    </li>
    <li>
      <a href="../articles/project_two.html">Project Two</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Linear Models: Building and
Interpreting Linear Regressions</h1>
                        <h4 data-toc-skip class="author">Stephanie J.
Spielman</h4>
            
            <h4 data-toc-skip class="date">Data Science for Biologists,
Spring 2020</h4>
      
      
      <div class="hidden name"><code>08_linear_models.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>CAUTION: This is NOT a full-fledged statistics course. This document
focuses on performing and interpretting linear regression models rather
than their mathematical underpinnings.</p>
</blockquote>
<div class="section level3">
<h3 id="cheatsheet-chunk">Cheatsheet chunk<a class="anchor" aria-label="anchor" href="#cheatsheet-chunk"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###### Building linear models with lm ######</span></span>
<span><span class="co"># Single predictor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">dataframe</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">lm_output</span></span>
<span></span>
<span><span class="co"># Multiple independent predictors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">dataframe</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">lm_output</span></span>
<span></span>
<span><span class="co"># Multiple predictors with an interaction effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span><span class="op">*</span><span class="va">X1</span>, data <span class="op">=</span> <span class="va">dataframe</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">lm_output</span></span>
<span></span>
<span></span>
<span><span class="co">##### Examining linear model output ######</span></span>
<span><span class="co"># Standard view of fitted model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_output</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Tidy views of fitted model with the broom library</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lm_output</span><span class="op">)</span>   <span class="co">## Coefficients</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">lm_output</span><span class="op">)</span> <span class="co">## R^2 and other _model fit_ metrics</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">lm_output</span><span class="op">)</span> <span class="co">## Get mmmooorrree information</span></span>
<span></span>
<span><span class="co"># Extract model info with the modelr library</span></span>
<span><span class="fu">modelr</span><span class="fu">::</span><span class="fu"><a href="https://modelr.tidyverse.org/reference/add_residuals.html" class="external-link">add_residuals</a></span><span class="op">(</span><span class="va">dataframe</span>, <span class="va">lm_output</span><span class="op">)</span>    <span class="co"># residuals for each observation</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="note">Note:<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>This week, we have a rare treat. A dear old friend of mine, <a href="https://spielmanlab.github.io/" class="external-link">Stephanie Spielman</a>, has a
lesson she’d like some feedback on. You are very welcome to make any
comments or suggestions on the <a href="https://github.com/sjspielman/datascience_for_biologists" class="external-link">GitHub
Repo</a> for the lesson.</p>
<div class="section level3">
<h3 id="what-is-a-linear-model">What is a linear model?<a class="anchor" aria-label="anchor" href="#what-is-a-linear-model"></a>
</h3>
<p>In statistics and data science, we often want to describe how the
value of one variable <em>depends on and/or can be explained/predited
by</em> the value of one or more other variables. For example, if we
know an individual’s height, could we reasonably predict their weight?
Said otherwise: to what extent can height explain variation we see in
weight? Potentially we might want to also consider a lot more
information like the person’s age, biological sex, health and diet, etc,
in addition to just their height. The variable we are interested in
predicting (here, <em>weight</em>) is known as the
<strong>response/dependent variable</strong>. We are interested in
seeing how certain other variables can provide meaningful information
about weight, and we call these other variables
<strong>predictor/explanatory/independent variables</strong>.</p>
<p>The term “linear model” implies a statistical framework for
quantifying to what degree <em>one or more predictor variables</em>
describes the variation seen in a <em>response variable</em>. Linear
models can answer questions like…</p>
<ul>
<li>Which of the predictor variables show a significant relationship
with the response variable?
<ul>
<li>In this case, <em>significant</em> (more or less..) implies that the
predictor variable’s values explain, to some degree, variation seen in
the response variable. An <em>insignificant</em> (again, more or less..)
predictor is one whose explanatory abilities on the variation in the
response variable are no different from random chance.</li>
</ul>
</li>
<li>How does do we expect the response value changes, on average, when
the predictor value changes?</li>
<li>How much variation in the response variable does each predictor
variable explain? And conversely, how much variation in the response
variable is unexplained?</li>
</ul>
<p>The mathematical model form of the <em>simplest</em> linear model
is:</p>
<p><span class="math display">\[\begin{equation}
  Y = \beta_1X_1 + \beta_0 + \epsilon
\end{equation}\]</span></p>
<p>The <span class="math inline">\(Y\)</span> is our response, and all
<span class="math inline">\(X\)</span> variables are our predictors - in
the simple example above, there is a single predictor <span class="math inline">\(X_1\)</span>. Each <span class="math inline">\(\beta\)</span> (Greek letter “beta”) is a given
predictor’s <em>coefficient</em>, and they quantify the relationship
between each predictor and the response. The <span class="math inline">\(\epsilon\)</span> (Greek letter “epsilon”)
represents the <em>error</em> in the model (read on!). In fact, the
formula above is actually the formula for a line, or as you may be used
to seeing it, <span class="math inline">\(Y = mX + B\)</span>. In our
new statistical notation, this <span class="math inline">\(\beta_1\)</span> is the slope <em>m</em>, and this
<span class="math inline">\(\beta_0\)</span> is the y-intercept
<em>B</em>. More generally for <em>N</em> predictors, we write the model
as (rearranged slightly)</p>
<p><span class="math display">\[\begin{equation} \label{eq:full}
  Y =  \beta_0 + \beta_1X_1 + \beta_2X_2 + \beta_3X_3 ... + \beta_NX_N +
\epsilon
\end{equation}\]</span></p>
<p>The error term <span class="math inline">\(\epsilon\)</span> is known
as the model’s <em>residuals</em> - how much variation in the response
is residual (left over) after considering all the predictors? In other
words, what percent of variation in the response variable is unexplained
by the predictor variable(s)? It is virtually never true that the
predictors will capture 100% of the variation in the response, and the
uncaptured percent falls into that <span class="math inline">\(\epsilon\)</span> term.</p>
<p>Practically, what does this formula mean? We can conceptualize this
most easily with a simple linear regression (<span class="math inline">\(Y = \beta_1X_1 + \beta_0\)</span>). Finding the
line-of-best-fit, which we will call the regression line, is an exercise
is finding the best values (aka values with the best <em>fit to the
data</em>) for the coefficients <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span>.</p>
<p>One of the most common procedures for fitting a model is called <a href="https://en.wikipedia.org/wiki/Ordinary_least_squares" class="external-link">“Ordinary
Least Squares,”</a> an algorithm that finds the line (aka best
coefficient values!) that minimizes the “sum of squares” of the
residuals. The residuals themselves are the <em>distance</em> between
each point and the regression line, and the sum of squares in this case
is, you guessed, the sum of the squared residuals. We’ll call it “RSS”:
the <strong>r</strong>esidual <strong>s</strong>um of
<strong>s</strong>quares. Consider this example (images from <a href="https://www.amazon.com/Analysis-Biological-Data-Michael-Whitlock/dp/1936221489" class="external-link">this
book</a>) that shows the relationship between the age of a given lion
the the proportion of its nose that is black (nose color changes over
time for cats and dogs! awwww):</p>
<p><img src="lm_files/whitlock_17.1-1.png" width="250"></p>
<p>The computer will try to find the best combination of values for the
slope (<span class="math inline">\(\beta_1\)</span>) and Y-intercept
(<span class="math inline">\(\beta_0\)</span>) that makes the RSS as
small as possible by testing out hundreds or thousands of different
values. This is what we mean by <strong>fitting a model</strong>: What
set of <em>parameter values</em> (fancy word for variables) match the
data the best?</p>
<p>In the three images below, we see three different ways this
regression line could be drawn. Each line segment from the the point to
the regression line is a residual!</p>
<p><img src="lm_files/whitlock_17.1-2.png" width="600"></p>
<ul>
<li>“Large deviations”: Very high RSS. This line is a poor fit to the
data.</li>
<li>“Smaller deviations”: A low RSS. The line is a better, but not best,
fit to the data.</li>
<li>“Smallest deviations”: This line represents the line that minimizes
the RSS. Its corresponding slope and intercept are our <em>model
parameters</em>. It turns out this slope is about <span class="math inline">\(\beta_1 = 10.64\)</span> and the intercept is
about <span class="math inline">\(\beta_0 = 0.88\)</span>. Our final
fitted model would therefore be <span class="math inline">\(Y = 10.64X_1
+ 0.88 + \epsilon\)</span>. In the coming sections we will learn how to
interpret these quantities.</li>
</ul>
</div>
<div class="section level3">
<h3 id="assumption-of-linear-regressions">Assumption of linear regressions<a class="anchor" aria-label="anchor" href="#assumption-of-linear-regressions"></a>
</h3>
<ul>
<li>“Linear regression”, which are used to model <strong>NUMERIC
response variables</strong>
</li>
</ul>
<p>These models make several key assumptions about the underlying
predictors and response variable. These assumptions represent properties
in the data itself which must be satisified in order for the models to
be reliably interpreted. <strong>Linear regressions are only valid if
these assumptions are met:</strong></p>
<ul>
<li>
<strong>Numeric predictors must have a linear relationship with the
numeric response.</strong> For example, in the two plots below, the LEFT
shows a linear relationship: This data is suitable for analysis with a
linear regression. The RIGHT shows a non-linear relationship: This data
is not suitable for analysis with a regression (unless you transform)
the data.</li>
</ul>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<ul>
<li>
<strong>Categorical predictors should have uniformly-distributed
variance</strong>. For example, in the two plots below, the LEFT shows a
numeric variable whose different distributions <em>across the
categorical variable have about the same spread</em> (although the means
differ!): This data is suitable for analysis with a linear regression.
The RIGHT shows an example where variance is NOT equally distributed,
and this may not be suitable for analysis with a linear regression.</li>
</ul>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<ul>
<li>
<strong>The <em>residuals</em> of the fitted model should be
normally-distributed (a bell curve).</strong> There is another type of
plot, called a “Q-Q plot” (“quantile-quantile”) we will see later in
this document for more carefully examining residuals.</li>
</ul>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-4-1.png" width="672">
+ <em>A common misconception</em> for regression is that the data itself
must be normally distributed. This is not true! It’s the
<em>residuals</em> that must be normally distributed, which can only be
examined after the model is fitted. Again, there is no requirement that
numeric predictors themselves or the response itself be normally
distributed!!</p>
<div class="section level4">
<h4 id="analyses-that-are-actually-all-linear-regression-models">Analyses that are actually all linear regression models<a class="anchor" aria-label="anchor" href="#analyses-that-are-actually-all-linear-regression-models"></a>
</h4>
<p>You will often hear these fancy statistical names for different
hypothesis tests. Fundamentally, they are all linear regressions with
different types of predictors. Really there is no need to distinguish
them!! You just need to know how to interpret predictor coefficients,
and you can make any model you want. Again, all linear regressions have
a <strong>numeric response</strong>.</p>
<ul>
<li>Correlation: Read on to the the next section!!</li>
<li>Simple linear regression: Models with a single <em>numeric</em>
predictor variable</li>
<li>Multiple linear regression: Models with several <em>numeric</em>
predictor variable</li>
<li>ANOVA (<strong>An</strong>alysis <strong>o</strong>f
<strong>Va</strong>riance): Models with a single <em>categorical</em>
predictor variable</li>
<li>MANOVA (<strong>M</strong>ultivariate <strong>An</strong>alysis
<strong>o</strong>f <strong>Va</strong>riance): Models with a multiple
<em>categorical</em> predictor variables</li>
<li>ANCOVA (<strong>An</strong>alysis of <strong>Cova</strong>riance):
Models with a single <em>categorical</em> AND one or more
<em>numeric</em> predictor variables</li>
<li>MANCOVA (<strong>M</strong>ultivariate <strong>An</strong>alysis of
<strong>Cova</strong>riance): Models with multiple <em>categorical</em>
AND multiple <em>numeric</em> predictor variables</li>
</ul>
<p>In fact, so are hypothesis tests like <em>t</em>-tests, and similarly
all their non-parametric equivalents - Mann-Whitney aka Wilcoxon, sign
test, and Kruskal-Wallis test. <a href="https://lindeloev.github.io/tests-as-linear/" class="external-link">This post</a> goes
into extensive depth about the how and why of this Truth.</p>
</div>
<div class="section level4">
<h4 id="briefly-correlation">Briefly, correlation<a class="anchor" aria-label="anchor" href="#briefly-correlation"></a>
</h4>
<p>A closely related (both conceptually and mathematically) topic here
is <em>correlation</em>, which is a quantity that tells us whether two
variables appear to be associated, or non-independent.
<strong>Correlation does NOT IMPLY causation</strong> - it merely
implies an observable pattern of association. There are many different
wants to quantify a correlation, but perhaps the most commonly-used one
is Pearson correlation. This quantity measures strength and direction a
of <strong>linear</strong> association between normally-distributed
numeric variables - it is virtually mathematically equivalent to a
simple linear regression. This is measured with the correlation
coefficient <em>r</em> which can be any value in <span class="math inline">\(-1 \leq r \leq 1\)</span>. Below are shown
examples of data with PERFECT correlations: there is a perfect x-y
association, but the directions are different. There is also an example
of NO correlation.</p>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-5-1.png" width="624"></p>
<p>The strength of the relationship is heavily influenced by
<em>noise</em> (images from <a href="https://www.amazon.com/Analysis-Biological-Data-Michael-Whitlock/dp/1936221489" class="external-link">this
book</a>). The farther points are from the middle, the more error
(residuals!!) there is, and hence the lower the correlation.</p>
<p><img src="lm_files/whitlock_16.6-1.png" width="600"></p>
<p><strong>But be careful!!</strong> The computer will still calculate a
correlation even if the data is not linearly related! The correlatio
below is NOT VALID because the assumption of linearity has not been met.
Always plot your data!!!</p>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-6-1.png" width="288"></p>
<p>There are other types of correlations that can be employed (for
example, Spearman rank correlation) when the data is not linearly
related. Fundamentally, if you run a linear regression, you have
implicitly run a correlation. Have some fun with correlations by <a href="http://guessthecorrelation.com/" class="external-link">practicing guessing the value for
<em>r</em></a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="examples-and-interpretation">Examples and interpretation<a class="anchor" aria-label="anchor" href="#examples-and-interpretation"></a>
</h3>
<p>All examples will use the external dataset <code>crabs</code> and
assume <span class="math inline">\(\alpha=0.05\)</span>. This dataset
contains physical measurements from 200 crabs, including their sex
(M/F), color (orange or blue), and various other quantities measured in
millimeters (mm). <strong>The goal of these examples is model body depth
in crabs. Therefore, the column <code>body_depth</code> is our response
variable.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"data/crabs.csv"</span><span class="op">)</span></span>
<span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">200</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (2): color, sex</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (5): frontal_lobe, rear_width, carapace_length, carapace_width, body_depth</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">)</span></span>
<span><span class="co">## Rows: 200</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ color           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "blue", "blue", "blue", "blue", "blue", "blue", "blue"…</span></span>
<span><span class="co">## $ sex             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "M", "M", "M", "M", "M", "M", "M", "M", "M", "M", "M",…</span></span>
<span><span class="co">## $ frontal_lobe    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 8.1, 8.8, 9.2, 9.6, 9.8, 10.8, 11.1, 11.6, 11.8, 11.8,…</span></span>
<span><span class="co">## $ rear_width      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.7, 7.7, 7.8, 7.9, 8.0, 9.0, 9.9, 9.1, 9.6, 10.5, 10.…</span></span>
<span><span class="co">## $ carapace_length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 16.1, 18.1, 19.0, 20.1, 20.3, 23.0, 23.8, 24.5, 24.2, …</span></span>
<span><span class="co">## $ carapace_width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 19.0, 20.8, 22.4, 23.1, 23.0, 26.5, 27.1, 28.4, 27.8, …</span></span>
<span><span class="co">## $ body_depth      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7.0, 7.4, 7.7, 8.2, 8.2, 9.8, 9.8, 10.4, 9.7, 10.3, 10…</span></span></code></pre></div>
<div class="section level4">
<h4 id="simple-linear-regression-single-numeric-predictor">Simple linear regression: Single numeric predictor<a class="anchor" aria-label="anchor" href="#simple-linear-regression-single-numeric-predictor"></a>
</h4>
<p>Let’s begin with a simple regression to examine the relationship
between <strong>carapace length</strong> and <strong>body
depth</strong>, specifically to what extent body depth can be explained
by carapace length. Therefore, carapace length is our predictor (X)
variable, and body depth is our response (Y) variable.</p>
<p><strong>The very first thing we should do is VISUALIZE our
data</strong> . Make sure that each numeric predictor (in this case
there is only 1!) indeed has a roughly <em>linear relationship</em> to
the response. Indeed, this relationship looks linear, and apparantly
(quite strongly!) positively related, so we are good to go.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># predictor goes on X, response goes on Y</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_length</span>, y <span class="op">=</span> <span class="va">body_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-8-1.png" width="384"></p>
<p>We perform regressions using the function <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> (any
guesses what this stands for?).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## perform linear regression and save as model_fit</span></span>
<span><span class="co">## Y ~ X !!!!!!!!!!!!!! </span></span>
<span><span class="co">## RESPONSE ~ PREDICTOR !!!!!!!!!!!!!!!!</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">carapace_length</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## view output with summary(). Ugly, useful for getting a visual overview.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ carapace_length, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.96587 -0.47864  0.07071  0.49976  1.43543 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)     -1.15527    0.20517  -5.631 6.09e-08 ***</span></span>
<span><span class="co">## carapace_length  0.47300    0.00624  75.803  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.6266 on 198 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9667, Adjusted R-squared:  0.9665 </span></span>
<span><span class="co">## F-statistic:  5746 on 1 and 198 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="interpreting-the-model-output">Interpreting the model output<a class="anchor" aria-label="anchor" href="#interpreting-the-model-output"></a>
</h4>
<ul>
<li><p><strong>Call</strong> simply reminds us of the linear model
formula we specified when using <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>.</p></li>
<li><p><strong>Residuals</strong> shows the <em>five-number summary</em>
of the distribution of the residuals.</p></li>
<li><p><strong>Coefficients</strong> tell us our <span class="math inline">\(\beta\)</span> values. Their <em>Estimate</em> is
the value the model returned, Their <em>Std. Error</em> indicates how
close/far these model estimates, derived from the sample, likely are
from the “true” population values. The <em>t value</em> is <em>t</em>
statistic associated with the estimate’s significance, and the final
column <em>Pr(&gt;|t|)</em> is the P-value associated with the
<em>t</em> statistic - it tells us if the coefficient is significant or
not. The null hypothesis for any coefficient is “Coefficient = 0.”
Therefore, a significant predictor coefficient means we are fairly sure
it’s value is not 0.</p></li>
<li><p><strong>(Intercept)</strong> is our fitted value for <span class="math inline">\(\beta_0\)</span>. It tells us: What is the
EXPECTED VALUE of the response variable when the numeric predictor value
is 0? In this case, what do we expect the average body depth will be
when a crab’s carapace length is 0 mm? Here, we expect that crabs will
have a body depth of -1.155 mm, on average, when their carapace length
is 0. We can also write this as -1.155±0.205 mm to acknowledge the
standard error! This is of course NOT realistic and illustrates
perfectly that you need to be careful to interpret coefficients with
biological intuition! Just because the computer spits out a number
doesn’t mean it’s meaningful. No crabs will have a body depth of 0mm.
Regardless, this quantity needs to be here to fulfill the mathematical
model itself - we’re just smart enough to know that the mathematical
model is terrible at biology. The intercept is highly significant
(<em>P=6.09e-08</em>). Therefore, there is evidence the intercept
differs from 0.</p></li>
<li><p><strong>carapace_length</strong> is our fitted value for <span class="math inline">\(\beta_1\)</span>. It tells us: What is the
EXPECTED change of the response the predictor increases by a unit of 1?
In this case, by how much do we expect body depth will increase/decrease
when the carapace length goes up by 1? Here, we expect for every 1 mm
increase in carapace length, body depth will <em>increases</em> by 0.473
mm (or, 0.473±0.00624 mm). Remember in this case, this value is the
slope (0.473 = rise/run = <span class="math inline">\(\Delta\)</span>body depth/<span class="math inline">\(\Delta\)</span>carapace length = 0.473/1 = 0.473
increase in body depth for ever 1 increase in carapace length). The
P-value here is highly significant at <em>P&lt;2.2e-16</em> (this is
nearly R’s lower bound for reporting tiny P-values), so we quite
confident that the true value indeed differs from 0.</p></li>
<li><p><strong>Residual standard error</strong>: The standard error
associated with residuals. The closer this value is to 0, the better our
model fit. We won’t focus much on this quantity, but be aware that large
values here indicate the model is rather poor. This value of 0.6266 is
fairly small.</p></li>
<li><p><strong>Multiple R-squared</strong> and <strong>Adjusted
R-squared</strong> give the <span class="math inline">\(R^2\)</span>
associated with the model. <strong>A model’s <span class="math inline">\(R^2\)</span> tells you the percent of variation in
the response that can be explained by the predictors</strong>. This is
SUPER important (and note, it is actually the squared Pearson
correlation coefficient!). The “Adjusted R-squared” is somewhat more
reliable for consideration - it corrects for any overfitting artifacts
inherent in modeling, so focus on this value. It’s associated P-value is
on the next line (here, <em>P&lt;2.2e-16</em>), and the associated null
hypothesis for this P-value is <span class="math inline">\(R^2 =
0\)</span>. <strong>In this model, 96.65% of the variation in body depth
can be explained by carapace lengths. 3.35% of the varation in body
depth is therefore UNEXPLAINED by our model.</strong> That 3.35% is
sneakily hidden in the <span class="math inline">\(\epsilon\)</span>
term of the fitted linear model formula. This <span class="math inline">\(R^2\)</span> is very close to 1 (100%) - this is
<em>a really really good model</em>.</p></li>
</ul>
<div class="section level5">
<h5 id="conclusions">Conclusions:<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h5>
<ul>
<li>Our fitted model is <span class="math inline">\(Y = 0.473X - 1.16 +
\epsilon\)</span>
</li>
<li>~96.65% of variation in crab body depth can be explained by carapace
length.</li>
<li>For every 1 mm increase in carapace length, we expect body depth to
increase, on average, by 0.473 mm.</li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="visualizing-the-model">Visualizing the model<a class="anchor" aria-label="anchor" href="#visualizing-the-model"></a>
</h4>
<p>We can visualize this output with a scatterplot and
<code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code>! This is why we’ve been saying
<code>method = "lm"</code> in <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code> - this function
adds a trendline, and by specify “lm” we are telling
<code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code> to use a linear model to determine the
trendline:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># predictor goes on X, response goes on Y</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_length</span>, y <span class="op">=</span> <span class="va">body_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>        <span class="co">## making the points small to help see the regression line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,     <span class="co">## make a trendline using "lm"</span></span>
<span>              color <span class="op">=</span> <span class="st">"navy"</span>,    <span class="co">## make the trendline navy</span></span>
<span>              size <span class="op">=</span> <span class="fl">0.5</span>,        <span class="co">## make the line small to help see the confidence interval for TUTORIAL REASONS</span></span>
<span>              fill <span class="op">=</span> <span class="st">"deeppink4"</span><span class="op">)</span> <span class="op">+</span> <span class="co">## fill for the confidence interval</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Carapace length (mm)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Body depth (mm)"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Linear regression to predict crab body depth"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,                <span class="co">## geom to annotate with is text annotation</span></span>
<span>           x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">30</span>,         <span class="co">## coordinates of the label, decided after trying several places..</span></span>
<span>           label <span class="op">=</span> <span class="st">"R^2 == 0.966"</span>, <span class="co">## label itself, double equals is needed for use with parse=T</span></span>
<span>           parse<span class="op">=</span><span class="cn">T</span>,               <span class="co">## makes label actually show as a formula, with squared as superscript!</span></span>
<span>           color <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">+</span> <span class="co">## font color and size </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p><strong>Critical followup: What is a confidence interval?</strong> A
confidence interval (CI) is meant to help convey <em>error</em> in the
estimate - in this case, the confidence bands you see (pink area around
the line) represents the error associated with our fitted slope aka our
model’s <span class="math inline">\(\beta_1\)</span> estimate! It is
directly related to “standard error”, so in the function
<code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code> you can turn it off as
<code>geom_smooth(se=F)</code> to not display it.</p>
<p>Loosely speaking, a <em>95% CI</em> (ggplot and many others use 95%
confidence interval by default) means: Assuming all the lovely
assumptions of our statistical framework, there is 95% probability that
the TRUE VALUE OF THE SLOPE is within the CI. Stated more accurately, if
you took N random samples of crabs and calculated their regressions of
body depth across carapace length, line (slope and intercept!) would
fall within the 95% shaded area CI for 95% of the samples.</p>
<p><strong>For an excellent intuitive understanding of what this means,
see <a href="https://github.com/wilkelab/ungeviz" class="external-link">the second plot
example in this package’s README</a>.</strong></p>
</div>
<div class="section level4">
<h4 id="checking-the-assumption-of-normal-residuals">Checking the assumption of normal residuals<a class="anchor" aria-label="anchor" href="#checking-the-assumption-of-normal-residuals"></a>
</h4>
<p>One of the assumptions of linear regressions is that residuals should
be normally distributed. Residuals are calculated as part of the model
itself, so the goal is to check the residuals AFTER you perform the
model to see if it worked out ok. If the residuals are severely not
normal, it means there were some problems with the model itself and you
need to rethink your approach - which predictors to include/exclude? add
in interaction effect [keep reading!!]? transform some of the data?</p>
<p>We can check this assumption using a <strong>Q-Q plot</strong>,
specifically a NORMAL QQ plot which shows the relationship between your
data and a <em>theoretical prediction</em> for what the data would like
if it were normally distributed. If the data falls roughly in a straight
line, the data is distributed normally!!! If not, not normal :(</p>
<p>First, we need to get the residuals themselves out of the model - my
preferred way for doing this uses the <code>broom()</code> package. This
packages tidies (sweeps up?…sigh.) model output into nice little
tibbles, and it has three main functions we want:
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code>, <code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">broom::glance()</a></code>, and
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">broom::augment()</a></code>. The first two are nice for collecting the
ugly summary data into tibbles. We simply pass in the model output
itself.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># redefining model just to orient you back</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">carapace_length</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assumes broom library is loaded! </span></span>
<span><span class="co"># it comes installed with tidyverse, but needs to be loaded with library(broom) in the setup chunk.</span></span>
<span><span class="co"># Gives coefficients in tidy form</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   term            estimate std.error statistic   p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)       -<span style="color: #BB0000;">1.16</span>    0.205       -<span style="color: #BB0000;">5.63</span> 6.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-  8</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> carapace_length    0.473   0.006<span style="text-decoration: underline;">24</span>     75.8  3.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-148</span></span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gives R^2 (and some other values, stay tuned!!!) in tidy form</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 12</span></span></span>
<span><span class="co">##   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     0.967         0.967 0.627     <span style="text-decoration: underline;">5</span>746. 3.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-148</span>     1  -<span style="color: #BB0000;">189.</span>  385.  395.</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Gives a whoooole bunch of under-the-hood info in tidy form - tacked onto the data itself!!!</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 200 × 8</span></span></span>
<span><span class="co">##    body_depth carapace_length .fitted   .resid    .hat .sigma .cooksd .std.resid</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        7              16.1    6.46  0.540   0.030<span style="text-decoration: underline;">4</span>   0.627 1.20<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>    0.875  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        7.4            18.1    7.41 -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">96</span> 0.024<span style="text-decoration: underline;">4</span>   0.628 1.16<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>   -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">63</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        7.7            19      7.83 -<span style="color: #BB0000;">0.132</span>   0.022<span style="text-decoration: underline;">0</span>   0.628 5.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   -<span style="color: #BB0000;">0.212</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        8.2            20.1    8.35 -<span style="color: #BB0000;">0.152</span>   0.019<span style="text-decoration: underline;">3</span>   0.628 5.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   -<span style="color: #BB0000;">0.245</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        8.2            20.3    8.45 -<span style="color: #BB0000;">0.247</span>   0.018<span style="text-decoration: underline;">8</span>   0.628 1.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>   -<span style="color: #BB0000;">0.397</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        9.8            23      9.72  0.076<span style="text-decoration: underline;">4</span>  0.013<span style="text-decoration: underline;">2</span>   0.628 1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>    0.123  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        9.8            23.8   10.1  -<span style="color: #BB0000;">0.302</span>   0.011<span style="text-decoration: underline;">8</span>   0.628 1.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>   -<span style="color: #BB0000;">0.485</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>       10.4            24.5   10.4  -<span style="color: #BB0000;">0.033</span><span style="color: #BB0000; text-decoration: underline;">1</span>  0.010<span style="text-decoration: underline;">7</span>   0.628 1.53<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   -<span style="color: #BB0000;">0.053</span><span style="color: #BB0000; text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        9.7            24.2   10.3  -<span style="color: #BB0000;">0.591</span>   0.011<span style="text-decoration: underline;">2</span>   0.627 5.10<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>   -<span style="color: #BB0000;">0.949</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>       10.3            25.2   10.8  -<span style="color: #BB0000;">0.464</span>   0.009<span style="text-decoration: underline;">73</span>  0.627 2.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>   -<span style="color: #BB0000;">0.744</span>  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 190 more rows</span></span></span></code></pre>
<p>Focusing on the <code>augment()</code> output, we see there are 136
rows - indeed there are 136 crabs!! Each row represents an outcome from
the model. The particular columns we may want are <code>.fitted</code>
and <code>.resid</code>:</p>
<ul>
<li>
<code>.fitted</code>: What does the model formula give for the
response at this predictor? For example, row 1 is an observation with
carapace length of 16.1 mm and body depth of 7 mm. If I put the
<em>predictor</em> 16.1 into the model <em><span class="math inline">\(Y
= 0.473X - 1.16\)</span></em>, I’d get: <span class="math inline">\((0.473\times16.1) - 1.16 = 6.46\)</span>!! We
won’t use this quantity now, but it’s really nice to know about.</li>
<li>
<code>.resid</code>: The residual associated with that row - this
column contains our residuals!!!</li>
</ul>
<p>For making QQ plots, we’ll use the base R functions
<code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm()</a></code> (for a <strong>norm</strong>al distribution QQ
plot) and <code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline()</a></code> (in this case base R is a lot easier
than ggplot2). They are run as <em>separate commands entirely</em>, but
R will always assume <code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline()</a></code> should go on top of the
<em>most recently run QQ plot</em>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## plot</span></span>
<span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">augmented_fit</span></span>
<span></span>
<span><span class="co"># plot the .resid column (yes it starts with a period), and add a line for visual guidance. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>  <span class="co">#Spielman personal preference, I like making it a color. base R uses "col"</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This is pretty good, but could be better - the tails of the plot, in
particular the right, have a bit of deviation, but not so much that I’d
worry. So, I’m satisified with the assumptions being met for this
model.</p>
<p><em>Here are examples of how the plot might look when it’s time to
start worrying:</em>
<img src="08_linear_models_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<p><strong>Notably</strong> there is another neat way to get the
residuals using the package <code>modelr</code> (within
<code>tidyverse</code>, but needs to be loaded). We will use several
more functions from this VERY helpful (but caution, often times very
advanced) package soon!. The function <code>add_residuals()</code> can
be used this way:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first argument is the data itself, second is the model object</span></span>
<span><span class="co">## output column `resid` contains the goods</span></span>
<span><span class="fu">modelr</span><span class="fu">::</span><span class="fu"><a href="https://modelr.tidyverse.org/reference/add_residuals.html" class="external-link">add_residuals</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 200 × 8</span></span></span>
<span><span class="co">##    color sex   frontal_lobe rear_width carapace_length carapace_width body_depth</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> blue  M              8.1        6.7            16.1           19          7  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> blue  M              8.8        7.7            18.1           20.8        7.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> blue  M              9.2        7.8            19             22.4        7.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> blue  M              9.6        7.9            20.1           23.1        8.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> blue  M              9.8        8              20.3           23          8.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> blue  M             10.8        9              23             26.5        9.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> blue  M             11.1        9.9            23.8           27.1        9.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> blue  M             11.6        9.1            24.5           28.4       10.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> blue  M             11.8        9.6            24.2           27.8        9.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> blue  M             11.8       10.5            25.2           29.3       10.3</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 190 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: resid &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="simple-anova-single-categorical-predictor">Simple ANOVA: Single categorical predictor<a class="anchor" aria-label="anchor" href="#simple-anova-single-categorical-predictor"></a>
</h4>
<p>What if, rather than a numeric predictor (carapace Length), we had a
<em>categorical</em> predictor, say sex? Here we might ask: <strong>Does
sex predict body depth in crabs</strong>? In the context of running an
explicit ANOVA, one might phrase it as: <strong>Does the variation in
body depth differ across sex in crabs?</strong> They are in fact the
same question!</p>
<p>Again, begin with a quick-and-dirty visualization. Here we’d like to
see that the distribution of body depths has similar <em>spread</em>
across sex categories (the assumption of equal variance for categorical
predictors!). Indeed, these two distributions show similar amounts of
spread (how much relative space along the Y axis they take up), so
assumption is met.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">body_depth</span>, color<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-15-1.png" width="384"></p>
<p>Let’s run the model:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## perform linear model and save as model_fit</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## view output with summary(). </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ sex, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -7.624 -2.449  0.076  2.463  7.376 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  13.7240     0.3420  40.134   &lt;2e-16 ***</span></span>
<span><span class="co">## sexM          0.6130     0.4836   1.268    0.206    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 3.42 on 198 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.00805,    Adjusted R-squared:  0.00304 </span></span>
<span><span class="co">## F-statistic: 1.607 on 1 and 198 DF,  p-value: 0.2064</span></span></code></pre>
<p><strong>This is where the order of categorical variables become
really important</strong>: All linear model output when categorical
predictors are used assumes a given level of the categorical variable.
Unless you re-factor a variable explicitly, levels will be used in
alphabetical order - here, “F” comes before “M”.</p>
<p>Coefficients associated with categorical predictors have a somewhat
different interpretation</p>
<p>We see the intercept is highly significant (<em>P&lt;2e-16</em>) with
a value of 13.724. <strong>Intercepts for a model with a categorical
predictor mean: What is the expected body depth of the baseline level,
which in this case is “F” (female)?</strong>. We expect the average
female crab to have a body depth of 13.72 mm. This is the “categorical”
analogy of a standard intercept that would be interpreted as, “what is
body depth when sex is 0?”. Of course, as a categorical variable, sex
cannot be 0 - it’s F or M in this dataset.</p>
<p>The coefficient associated with SexM means, <strong>How does being
male influence body depth relative to the factor baseline,
female?</strong> On average, males have body depth 0.613 mm larger than
females. (Notably, for a categorical variable with <em>N</em> levels,
there will be see <em>N-1</em> coefficients). In this case, however, the
P-value is NOT significant (P=0.206). Similarly our adjusted
<em>R^2</em> is not significant. Therefore, we actually do not see
evidence that the average male body depth differs from the average
female body depth.</p>
<p><strong>This model therefore tells us: sex is NOT explanatory of body
depth in crabs!</strong> Either way, let’s think how we might visualize
the model results. The strip plot used above to check assumptions is a
pretty good way to do it, or any other way to show distributions. That
said, these models operate on <em>means</em>, so it might be useful to
actually visualize the means specifically. A neat trick for doing this
comes from <code><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary()</a></code>!!</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">body_depth</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sex"</span>, y <span class="op">=</span> <span class="st">"Body depth (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="st">"mean_se"</span>, <span class="co"># calculate mean and se</span></span>
<span>               color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p>As you can see, those means look about identical and their standard
errors overlap - it makes sense that the model did <em>not</em> show
evidence that sex is predictive of body depth.</p>
<div class="section level5">
<h5 id="as-an-anova">As an ANOVA<a class="anchor" aria-label="anchor" href="#as-an-anova"></a>
</h5>
<p>For posterity, it can’t hurt to see how this looks as a bonafide
ANOVA table using the function <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">anova_model_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">anova_model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">## sex           1   18.8   18.79   1.607  0.206</span></span>
<span><span class="co">## Residuals   198 2315.3   11.69</span></span></code></pre>
<p>In case anyone needs a reminder, DF is degrees of freedom, or the
number of independent variables in the analysis. Mean square error is
the sum of squares (how far points deviate from mean) divided by the
degrees of freedom. F-statistic is the mean square of the residuals
divided by mean square error. The P-Value is the value that we’d see an
F-statistic of at least this extreme if there is no effect of the
predictor variable.</p>
</div>
</div>
<div class="section level4">
<h4 id="lm-with-numeric-and-categorical-predictors">LM with numeric and categorical predictors<a class="anchor" aria-label="anchor" href="#lm-with-numeric-and-categorical-predictors"></a>
</h4>
<p>Let’s see how to run and interpret a model with BOTH numeric and
categorical predictors. We will examine how color and carapace length
together might be predictive of body depth in crabs. Said otherwise:
We’ve seen how carapace length influences body depth. Does this effect
persist when controlling for color? Importantly, when you have multiple
predictors, the model assumes they are FULLY INDEPENDENT and ENTIRELY
UNRELATED. Of course this is not always true - read on to learn more
about how to deal with this issue!</p>
<p>Let’s run the model with multiple predictors, which we simply add
together in the formula</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## order of predictors does NOT matter</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">color</span> <span class="op">+</span> <span class="va">carapace_length</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## view output with summary(). </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ color + carapace_length, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.31623 -0.22544  0.00332  0.27120  1.08043 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)     -0.996643   0.123044   -8.10 5.65e-14 ***</span></span>
<span><span class="co">## colororange      1.044956   0.055373   18.87  &lt; 2e-16 ***</span></span>
<span><span class="co">## carapace_length  0.451781   0.003899  115.87  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.3749 on 197 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9881, Adjusted R-squared:  0.988 </span></span>
<span><span class="co">## F-statistic:  8204 on 2 and 197 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>When considering BOTH color and carapace length as model predictors,
we find:</p>
<ul>
<li>The intercept means your average blue (the baseline level of
<code>color</code>) crab <em>with a carapace length of 0</em> has a body
depth of -0.997 mm. It’s highly sigificant but unrealistic - moving
on.</li>
<li>The “colororange” means <em>when controlling for carapace
length</em>, your average orange crab’s body depth will be ~1.045 mm
larger than an average crab. Again, highly significant.</li>
<li>The “carapace_length” coefficient means <em>when controlling for
color</em>, the average crab’s body depth increases by 0.452 per 1 mm
increase in carapace length, and it’s highly significant.</li>
<li>The predictors explain <em>~98.8%</em> of the variation in body
depth - our model appears to have improved in predictive ability by
jointly considering color with carapace length! A mere 1.2% of variation
in body depth is unexplained by the two significant predictors.</li>
</ul>
<p>Let’s check our residuals as well with a QQ plot. We find that they
are indeed normally distributed, so the model’s assumptions have been
met and we can rely on its output.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">augment</span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">augmented_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p><strong>How can we visualize this model?</strong> We can again make a
scatterplot, and show the trend lines for each sex:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_length</span>, y <span class="op">=</span> <span class="va">body_depth</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Carapace length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body Depth (mm)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Crab color"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># why not!</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">30</span>, label <span class="op">=</span> <span class="st">"R^2 == 0.988"</span>, parse<span class="op">=</span><span class="cn">T</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="lm-with-multiple-numeric-predictors">LM with multiple numeric predictors<a class="anchor" aria-label="anchor" href="#lm-with-multiple-numeric-predictors"></a>
</h4>
<p>Now we will look at a model with multiple numeric predictors,
carapace width <em>and</em> carapace length. We know already that
carapace length has a linear relationship with body depth from earlier
in this document, so let’s just check out the linearity of body
depth/carapace width. Indeed, the relationship is linear, so let’s
proceed.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_width</span>, y <span class="op">=</span> <span class="va">body_depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-22-1.png" width="288"></p>
<p>Again, we can simply add predictors together (order does not
matter!):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## perform linear model and save as model_fit</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">carapace_width</span> <span class="op">+</span> <span class="va">carapace_length</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## view output with summary(). </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ carapace_width + carapace_length, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.78651 -0.35206 -0.01679  0.35397  1.61916 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)     -0.65396    0.17540  -3.728 0.000252 ***</span></span>
<span><span class="co">## carapace_width  -0.45995    0.04636  -9.922  &lt; 2e-16 ***</span></span>
<span><span class="co">## carapace_length  0.97907    0.05126  19.099  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.513 on 197 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9778, Adjusted R-squared:  0.9776 </span></span>
<span><span class="co">## F-statistic:  4336 on 2 and 197 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<p>Our model has found:</p>
<ul>
<li>You average crab with carapace width and carapace length both equal
to zero will have, on average, a body depth of -0.65, and this is highly
significant at <em>P=0.000252</em>. But of course, this is not
biologically meaningful - it just is needed to build the model.</li>
<li>On average, we expect that body depth <em>decreases</em> by ~0.46
when carapace width increases by 1 mm, <em>assuming carapace LENGTH is
unchanged</em>. This is also highly significant.</li>
<li>On average, we expect that body depth <em>increases</em> by ~0.979
when carapace length increases 1 mm, <em>assuming carapace WIDTH is
unchanged</em>. This is also highly significant.</li>
<li>The independent effects of carapace length and width explain roughly
97.76% of variation in body depth, and it is highly significant.</li>
</ul>
<p>A quick check of residuals also shows normality, so we’re all
set.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">augment</span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">augmented_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>We could visualize this if we want by putting on predictor on the X,
and using color to disinguish the other predictor. That said, it is very
difficult to make scatterplot visualizations with multiple numeric
predictors, especially since we can’t draw two trend lines in one set of
axes.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_length</span>, y <span class="op">=</span> <span class="va">body_depth</span>, color <span class="op">=</span> <span class="va">carapace_width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span> <span class="co"># i like the plot with bigger points </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Carapace length (mm)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Body depth (mm)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Carapace width (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">30</span>, label <span class="op">=</span> <span class="st">"R^2 == 0.977"</span>, parse<span class="op">=</span><span class="cn">T</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="co"># again my personal preference</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="lm-with-interaction-effects">LM with interaction effects<a class="anchor" aria-label="anchor" href="#lm-with-interaction-effects"></a>
</h4>
<p>So far, we have fit TWO models that have multiple predictors: 1)
using color and carapace length, and 2) using carapace width and
carapace length. Both models made the assumption that all predictors are
independent of one another, e.g. carapace width and length are
independent (in statistical terms, we’d say those models used “additive
effects”). Of course, this is unlikely to be the case. In addition, it
is possible that the effects of carapace length on body depth
<em>depend</em> on carapace width, and vice versa. We would call this an
<strong>interaction effect.</strong></p>
<p>As a general rule, when you have multiple predictors for a linear
model, it is usually a good idea to FIRST run the model assuming an
interaction effect. If the interaction effect is not significant, use an
additive model instead. If the interaction effect IS significant,
<em>ignore</em> the additive effects and report only on the interaction
effects. Indeed, if there is a significant interaction, it no longer
makes sense to focus on individual contributions.</p>
<div class="section level5">
<h5 id="example-1">Example #1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h5>
<p>Previously, we looked at the explanatory power of carapace length and
color on body depth as independent effects. What if they are not
independent, however? Looking at the visualization we made from this
model, we see that the two regression lines for each crab color are
roughly parallel - this suggests that the relationship between carapace
length and body depth is consistent regardless of color. This would mean
NO interaction effect, but we can formally test this out by adding an
interaction term to the model:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># interact by using * instead of + for predictors</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">carapace_length</span> <span class="op">*</span> <span class="va">color</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ carapace_length * color, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.22825 -0.19428 -0.01018  0.22544  1.01383 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)                 -0.667829   0.165192  -4.043 7.59e-05 ***</span></span>
<span><span class="co">## carapace_length              0.440842   0.005358  82.282  &lt; 2e-16 ***</span></span>
<span><span class="co">## colororange                  0.327083   0.252010   1.298  0.19585    </span></span>
<span><span class="co">## carapace_length:colororange  0.022331   0.007655   2.917  0.00394 ** </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.368 on 196 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9886, Adjusted R-squared:  0.9885 </span></span>
<span><span class="co">## F-statistic:  5681 on 3 and 196 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<p>In this output…</p>
<ul>
<li>
<strong>carapace_length</strong> is the <em>independent</em>
coefficient for carapace_length</li>
<li>
<strong>colororange</strong> is the <em>independent</em> coefficient
for color</li>
<li>
<strong>carapace_length:colororange</strong> is the <em>interaction
effect</em> coefficient for caparace length x color, and it is in fact
significant at <em>P=0.00394</em>!! Indeed, there <strong>is</strong> a
significant difference in trend between crab colors. However it’s quite
hard to see in the plot - this is a great example of when statistical
significance corresponds to only moderate, in this case, small, effect
size.</li>
</ul>
<p>Our residuals are also normally distributed:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">augment</span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">augmented_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Upon finding a significant interaction effect, we promptly
<em>ignore</em> any independent effects - since the interaction tells us
these variables are not independent, it does not make sense to consider
their independent influence on body depth. We have evidence that the way
that carapace length affects body depth depends on color! Similarly, the
way that color affects body depth depends on carapace length.</p>
<p>The best way to interpret this model is not to focus on the
interaction term coefficient (they’re a little tricky..), but rather to
make a plot like we did earlier with the two slopes, and see how those
slopes potentially cross or interact, or in this case are only barely
non-parallel. In fact, although small, these slopes are NOT identical
and the lines are NOT exactly parallel - there is a significant
interaction! However, it is of course a very small effect size.
<strong>The punchline here is that the interaction is significant, so we
have evidence that carapace length and color INTERACT when explaining
body depth.</strong></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carapace_length</span>, y <span class="op">=</span> <span class="va">body_depth</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Carapace length (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body Depth (mm)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Crab color"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">30</span>, label <span class="op">=</span> <span class="st">"R^2 == 0.988"</span>, parse<span class="op">=</span><span class="cn">T</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
<p>NOTE: It is possible to directly specify the interaction effect to
the linear model like so - in fact the interaction effect is a <em>third
term</em> in the model:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">carapace_length</span> <span class="op">+</span> <span class="va">color</span> <span class="op">+</span> <span class="va">carapace_length</span><span class="op">:</span><span class="va">color</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ carapace_length + color + carapace_length:color, </span></span>
<span><span class="co">##     data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.22825 -0.19428 -0.01018  0.22544  1.01383 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)                 -0.667829   0.165192  -4.043 7.59e-05 ***</span></span>
<span><span class="co">## carapace_length              0.440842   0.005358  82.282  &lt; 2e-16 ***</span></span>
<span><span class="co">## colororange                  0.327083   0.252010   1.298  0.19585    </span></span>
<span><span class="co">## carapace_length:colororange  0.022331   0.007655   2.917  0.00394 ** </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.368 on 196 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.9886, Adjusted R-squared:  0.9885 </span></span>
<span><span class="co">## F-statistic:  5681 on 3 and 196 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
</div>
<div class="section level5">
<h5 id="example-2">Example #2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h5>
<p>Let’s do another interaction model by considering two <em>categorical
predictors</em>, sex and color. This can be visualized with an
<em>interaction plot</em> which explictly show how the <em>mean
response</em> (here, mean body depth) depends on levels of two
categorical predictor:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crabs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## get mean body depth per group first</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">color</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_body_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">body_depth</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">mean_body_depth</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"orange"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">## argument.</span></span></code></pre>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-30-1.png" width="432"></p>
<p>This plot suggests potential interaction effect! It seems female
orange crabs have higher mean body depths compared to male orange crabs,
but the opposite appears true blue. Notably, you see the <em>slopes of
these lines do not match.</em> (Lines have the same slope - the effect
of sex does NOT appear to depend on Color.) A linear model will tell us
if this potential interaction is significant - but note the tiny tiny
breaks on the Y-axis? If there is a significant interation, it will
likely have a very small effect size.</p>
<p>Let’s go ahead and see:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># interact by using * instead of + for predictors</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">body_depth</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">color</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = body_depth ~ sex * color, data = crabs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">## -7.924 -2.224  0.059  2.250  6.650 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)       11.8160     0.4349  27.167  &lt; 2e-16 ***</span></span>
<span><span class="co">## sexM               1.5340     0.6151   2.494   0.0135 *  </span></span>
<span><span class="co">## colororange        3.8160     0.6151   6.204 3.21e-09 ***</span></span>
<span><span class="co">## sexM:colororange  -1.8420     0.8699  -2.118   0.0355 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 3.075 on 196 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.2058, Adjusted R-squared:  0.1936 </span></span>
<span><span class="co">## F-statistic: 16.93 on 3 and 196 DF,  p-value: 8.131e-10</span></span></code></pre>
<p>In this output…</p>
<ul>
<li>
<strong>sexM</strong> is the <em>independent</em> coefficient for
sex</li>
<li>
<strong>colororange</strong> is the <em>independent</em> coefficient
for color</li>
<li>
<strong>sexM:colororange</strong> is the <em>interaction effect</em>
coefficient for sex x color, and it is moderately significant at
<em>P=0.0355</em>.</li>
</ul>
<p>And, residuals again are ok:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">augment</span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">augmented_fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">augmented_fit</span><span class="op">$</span><span class="va">.resid</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="08_linear_models_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>The best way to interpret this model is to a) identify if an
interaction is significant, and b) compare the means with an interaction
plot. We’ve basically done all those steps, so we are set!</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by April Wright.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
